# SQL –ó–∞–ø—Ä–æ—Å—ã –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ªÔøΩÔøΩ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ü–µ–ª–µ–π.

## üìã –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤

### 1. `extract_orders.sql` - –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í—ã–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–æ–≤ —Å —Ä–∞—Å—á–µ—Ç–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `$start_date` - –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD)
- `$end_date` - –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD)
- `$status_filter` - –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–∫–∞–∑–∞
- `$limit` - –õ–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)

**–ú–µ—Ç—Ä–∏–∫–∏**:

- –û–±—â–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π
- –û–ø–ª–∞—á–µ–Ω–Ω–∞—è —Å—É–º–º–∞
- –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–≥–æ–¥, –º–µ—Å—è—Ü, –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏, —á–∞—Å)

### 2. `extract_products.sql` - –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í—ã–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø—Ä–æ–¥–∞–∂  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `$category_filter` - –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `$min_stock` - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ
- `$active_only` - –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (TRUE/FALSE)
- `$limit` - –õ–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)

**–ú–µ—Ç—Ä–∏–∫–∏**:

- –û–±—â–∏–µ –ø—Ä–æ–¥–∞–∂–∏
- –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
- –ü—Ä–∏–±—ã–ª—å –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É
- –°—Ç–∞—Ç—É—Å –∑–∞–ø–∞—Å–æ–≤
- –°–∫–æ—Ä–æ—Å—Ç—å –æ–±–æ—Ä–æ—Ç–∞

### 3. `extract_customers.sql` - –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í—ã–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∞–Ω–∞–ª–∏–∑–æ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `$status_filter` - –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –∫–ª–∏–µ–Ω—Ç–∞
- `$min_orders` - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤
- `$start_date` - –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `$end_date` - –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `$limit` - –õ–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)

**–ú–µ—Ç—Ä–∏–∫–∏**:

- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤
- –û–±—â–∞—è –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–∞—è —Å—É–º–º–∞
- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –æ–ø–ª–∞—Ç—ã
- –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –°—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### 4. `extract_kpi_metrics.sql` - KPI –º–µ—Ç—Ä–∏–∫–∏

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ KPI –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `$start_date` - –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -30 –¥–Ω–µ–π)
- `$end_date` - –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ–≥–æ–¥–Ω—è)
- `$granularity` - –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: 'day', 'week', 'month'

**–ú–µ—Ç—Ä–∏–∫–∏**:

- –ó–∞–∫–∞–∑—ã
- –ï–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤
- –í–∞–ª–æ–≤–∞—è –≤—ã—Ä—É—á–∫–∞
- –û–ø–ª–∞—á–µ–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ (Net Paid)
- AOV (—Å—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–∫–∞–∑–∞)
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –æ–ø–ª–∞—Ç—ã
- –î–æ–ª—è –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã

### 5. `extract_geography_channels.sql` - –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –∏ –∫–∞–Ω–∞–ª—ã

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–Ω–∞–ª–∏–∑ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º/—Ä–∞–π–æ–Ω–∞–º –∏ –∫–∞–Ω–∞–ª–∞–º –ø—Ä–æ–¥–∞–∂  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `$start_date` - –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞
- `$end_date` - –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞
- `$region_filter` - –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–≥–∏–æ–Ω—É
- `$limit` - –õ–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)

**–ê–Ω–∞–ª–∏–∑**:

- –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã (—Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã, –≤–µ—á–µ—Ä, –Ω–æ—á—å)
- –ë–∏–∑–Ω–µ—Å –∫–∞–Ω–∞–ª—ã (B2B/B2C)
- –¢–∏–ø—ã –¥–Ω–µ–π (–±—É–¥–Ω–∏/–≤—ã—Ö–æ–¥–Ω—ã–µ)

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ API

```javascript
// –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ —á–µ—Ä–µ–∑ frontend API
const result = await dbService.executeQuery(
  `
  ${sql_query_content}
`,
  {
    start_date: '2024-01-01',
    end_date: '2024-12-31',
    limit: 500,
  },
)
```

### –ù–∞–ø—Ä—è–º—É—é –≤ PostgreSQL

```sql
-- –ó–∞–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
-- –ü—Ä–∏–º–µ—Ä –¥–ª—è extract_orders.sql:

-- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
\set start_date '2024-01-01'
\set end_date '2024-12-31'
\set status_filter 'completed'
\set limit 1000

-- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
\i extract_orders.sql
```

### –ß–µ—Ä–µ–∑ psql —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```bash
psql -h host -d database -U user \
  -v start_date='2024-01-01' \
  -v end_date='2024-12-31' \
  -v limit=1000 \
  -f extract_orders.sql
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ú–µ—Å—è—á–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –ø–æ –∑–∞–∫–∞–∑–∞–º

```sql
-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è extract_orders.sql
$start_date = '2024-12-01'
$end_date = '2024-12-31'
$status_filter = NULL
$limit = NULL
```

### 2. –ê–Ω–∞–ª–∏–∑ —Ç–æ–ø-—Ç–æ–≤–∞—Ä–æ–≤

```sql
-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è extract_products.sql
$category_filter = NULL
$min_stock = NULL
$active_only = TRUE
$limit = 50
```

### 3. VIP –∫–ª–∏–µ–Ω—Ç—ã

```sql
-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è extract_customers.sql
$status_filter = 'active'
$min_orders = 10
$start_date = NULL
$end_date = NULL
$limit = 100
```

### 4. –ù–µ–¥–µ–ª—å–Ω—ã–µ KPI

```sql
-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è extract_kpi_metrics.sql
$start_date = '2024-12-01'
$end_date = '2024-12-31'
$granularity = 'week'
```

### 5. –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

```sql
-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è extract_geography_channels.sql
$start_date = '2024-12-01'
$end_date = '2024-12-31'
$region_filter = '–ú–æ—Å–∫–≤–∞'
$limit = NULL
```

## üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```sql
-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã orders
CREATE INDEX IF NOT EXISTS idx_orders_date ON orders(order_date);
CREATE INDEX IF NOT EXISTS idx_orders_status ON orders(status);
CREATE INDEX IF NOT EXISTS idx_orders_payment_status ON orders(payment_status);
CREATE INDEX IF NOT EXISTS idx_orders_customer ON orders(customer_id);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã order_items
CREATE INDEX IF NOT EXISTS idx_order_items_order ON order_items(order_id);
CREATE INDEX IF NOT EXISTS idx_order_items_product ON order_items(product_id);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã customers
CREATE INDEX IF NOT EXISTS idx_customers_status ON customers(status);
CREATE INDEX IF NOT EXISTS idx_customers_registration ON customers(registration_date);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–∞–±–ª–∏ÔøΩÔøΩ—ã products
CREATE INDEX IF NOT EXISTS idx_products_category ON products(category);
CREATE INDEX IF NOT EXISTS idx_products_active ON products(is_active);
CREATE INDEX IF NOT EXISTS idx_products_stock ON products(stock_quantity);
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã** - –≤—Å–µ–≥–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞–∑—É–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã** - –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–≥–∏–Ω–∞—Ü–∏—é
3. **–ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ EXPLAIN ANALYZE

## ‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è PostgreSQL
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `$parameter_name`
- NULL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è (–Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç —Ñ–∏–ª—å—Ç—Ä)
- –í—Å–µ –¥–µ–Ω–µ–∂–Ω—ã–µ —Å—É–º–º—ã –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
- –ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ —Å–µ—Ä–≤–µ—Ä–∞ –ë–î

## üîç –û—Ç–ªÔøΩÔøΩ–¥–∫–∞

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
EXPLAIN ANALYZE [–≤–∞—à_–∑–∞–ø—Ä–æ—Å];

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
SELECT * FROM pg_stat_statements
WHERE query LIKE '%–≤–∞—à_–∑–∞–ø—Ä–æ—Å%';
```
